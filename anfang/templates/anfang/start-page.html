{% extends "anfang/bootstrap-generic.html" %}
{% block extraheader %}
{% load staticfiles %}
<link rel="stylesheet" href ={% static "css/start-page.css" %}>
<script>
 var foo = null;
 var lat = null;
 var lng = null;
 var map = null;
 var service = null;
 function createMarker(place) {
   var placeLoc = place.geometry.location;
   var marker = new google.maps.Marker({
     map: map,
     position: place.geometry.location
   });

   infowindow = new google.maps.InfoWindow();
   infowindow.setContent(place.name);
   google.maps.event.addListener(marker, 'click', function() {
     infowindow.setContent(place.name);
     infowindow.open(map, this);
   });
 }
 $(document).ready(function() {
   map = new google.maps.Map(document.getElementById('map'),
			     mapOptions);
   foo = new google.maps.places.AutocompleteService();
   var mapOptions = {
     center: { lat:  40.7929616, lng: -73.96727329999999},
     zoom: 16
   };
   map = new google.maps.Map(document.getElementById('map'),
			     mapOptions);
   navigator.geolocation.getCurrentPosition(
     function(pos) {
       lat = pos.coords.latitude;
       lng = pos.coords.longitude;
       map.setZoom(16);
       map.setCenter(new google.maps.LatLng(lat, lng));
       service = new google.maps.places.PlacesService(map);
     });
   $('#mapssearch').keyup(function(e){
     if(e.keyCode == 13) {
       // set up autocompletion request object
       var x = {};
       x.keyword = $('#mapssearch').val();
       x.location = new google.maps.LatLng(lat, lng);
       x.radius = 1000;
       x.rankby = google.maps.places.RankBy.DISTANCE;
       x.types = ['restaurant'];
       service.nearbySearch(
	 x,
	 function(results, status) {
	   if (status != google.maps.places.PlacesServiceStatus.OK) {
	     return;
	   }
	   for (i = 0; i < results.length; i++) {
	     createMarker(results[i]);
	   }
	 });
     }
   });
 });
</script>
{% endblock %}
{% block body %}
{% if err %}
<font color=red>{{ err }} </font><br>
{% endif %}
<div class="row">
  <div class="col-md-2 col-sm-2">
  </div>
  <div class="col-md-4 col-sm-4" align="center">
    {% if other_user_profile.profile_picture %}
    <img width="50%" class="img-responsive" src="{{ other_user_profile.profile_picture.picture.url }}">
    {% endif %}
  </div>
  <div class="col-md-4 col-sm-4" style="height: 800px;">
      <form action="{% url 'anfang:new_status' %}" method="post" id="new-status">
	{% csrf_token %}
	<div id="status">
	  {{ status_form }}
	</div>
      </form>
    <div class="media">
      <ul class="list-group">
	{% for s in status_updates %}
	<li class="list-group-item">
	  <div class="pull-left media-object">
	    <img width="50%" class="img-responsive" src={{ s.posting_user.userprofile.profile_picture.picture.url }}>
	  </div>
	  <div class ="media-body">
	    <p class="media-heading" style="word-wrap:break-word;">
	      {{ s.text }}
	      <small class="pull-right">{{ s.time }}</small>
	    </p>
	  </div>
	</li>
	{% endfor %}
      </ul>
    </div>
    <div id="map" style="height: 500px; width=100%;>
    </div>
  </div>
  <div class="col-md-2 col-sm-2">
  </div>
</div>
{% endblock %}
